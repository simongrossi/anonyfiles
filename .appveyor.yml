image:
  - Visual Studio 2022   # Windows
  - macOS                # macOS (mapped à macos-monterey)

environment:
  matrix:
    - PYTHON: "3.11"

install:
  # Mettre à jour pip
  - ps: python -m pip install --upgrade pip
  # Déps CLI Python
  - ps: python -m pip install -r anonyfiles-cli/requirements.txt
  # Déps GUI Node/Rust
  - ps: npm install --prefix anonyfiles-gui
  - ps: cargo fetch --manifest-path anonyfiles-gui/src-tauri/Cargo.toml

build: off

build_script:
  # Tests Python
  - ps: python -m pytest --maxfail=1 --disable-warnings anonyfiles-cli/tests
  # Build GUI (Svelte + Tauri/Rust)
  - ps: npm run build --prefix anonyfiles-gui
  - ps: cargo build --manifest-path anonyfiles-gui/src-tauri/Cargo.toml --release

artifacts:
  - path: anonyfiles-cli/dist/*.whl
  - path: anonyfiles-gui/src-tauri/target/release/*
