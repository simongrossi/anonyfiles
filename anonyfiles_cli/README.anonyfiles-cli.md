# üñ•Ô∏è Anonyfiles CLI

**Anonyfiles CLI** est l‚Äôoutil en ligne de commande du projet Anonyfiles pour anonymiser des fichiers texte, tableurs et documents Office. Il utilise le NLP (spaCy), une configuration flexible en YAML et plusieurs strat√©gies de remplacement, garantissant la confidentialit√© des donn√©es personnelles dans tous types de documents professionnels.

---

## üöÄ Fonctionnalit√©s principales

* **Multi-format :** `.txt`, `.csv`, `.docx`, `.xlsx`, `.pdf`, `.json` (avec gestion am√©lior√©e des fichiers vides).
* **D√©tection d‚Äôentit√©s avanc√©e** (spaCy) : Personnes (`PER`), Lieux (`LOC`), Organisations (`ORG`), Dates, Emails, T√©l√©phones, IBAN, Adresses, etc.
* **Configuration YAML des strat√©gies spaCy** : personnalisation fine des strat√©gies de remplacement (Faker, codes, etc.) pour les entit√©s *d√©tect√©es par spaCy*, et exclusions par pattern.
* **R√®gles de remplacement personnalis√©es via CLI (pour .TXT initialement) :** D√©finissez vos propres patterns (texte ou regex simple) et leurs remplacements directs, appliqu√©s *avant* la d√©tection spaCy.
* **Export CSV du mapping d‚Äôanonymisation** : permet la d√©sanonymisation/audit des entit√©s trait√©es par spaCy.
* **Log CSV des entit√©s d√©tect√©es** (par spaCy) : suivi, validation, stats.
* **Exclusion s√©lective d‚Äôentit√©s spaCy** via `--exclude-entities`.
* **D√©sanonymisation compl√®te** via le mapping CSV g√©n√©r√©.
* **Support du traitement batch de plusieurs fichiers** (par dossier).
* **Performance optimis√©e** pour les gros volumes (lazy loading, memory-safe).
* **Logs d√©taill√©s/debug** activables.

---

## üõ†Ô∏è Pr√©requis & Installation

* Python 3.8 ou sup√©rieur
* Cloner le d√©p√¥t :
    ```sh
    git clone [https://github.com/simongrossi/anonyfiles.git](https://github.com/simongrossi/anonyfiles.git)
    cd anonyfiles/anonyfiles_cli
    ```
* Installer les d√©pendances Python :
    ```sh
    pip install -r requirements.txt
    ```
* (Optionnel) Installer [spaCy FR](https://spacy.io/models/fr) :
    ```sh
    python -m spacy download fr_core_news_md
    ```

---

## üí° Utilisation rapide

### ‚ñ∂Ô∏è Anonymisation d‚Äôun fichier

```sh
python main.py anonymize chemin/vers/fichier.txt \
  --config chemin/vers/config.yaml \
  --custom-replacements-json '[{"pattern": "Mon Texte Secret", "replacement": "[REMPLAC√â]"}]' \
  -o chemin/vers/fichier_anonymise.txt \
  --log-entities chemin/vers/log_entities.csv \
  --mapping-output chemin/vers/mapping.csv \
  --exclude-entities ORG,EMAIL,LOC
Param√®tres principaux :
chemin/vers/fichier.txt : fichier √† anonymiser
--config : chemin du fichier de configuration YAML (pour les strat√©gies spaCy)
--custom-replacements-json : (Optionnel) Cha√Æne JSON de r√®gles de remplacement personnalis√©es directes (ex: '[{"pattern": "texte_a_cacher", "replacement": "[CACHE]"}]'). Initialement pour les fichiers .txt.
-o ou --output : fichier de sortie anonymis√©
--log-entities : CSV listant les entit√©s spaCy d√©tect√©es
--mapping-output : CSV pour la d√©sanonymisation des entit√©s spaCy
--exclude-entities : entit√©s spaCy √† NE PAS anonymiser (par label)
Seuls le fichier d‚Äôentr√©e et la config YAML sont obligatoires. Utilisez --exclude-entities pour cibler pr√©cis√©ment ce que vous souhaitez que spaCy anonymise ou ignore. Les r√®gles personnalis√©es via CLI offrent un contr√¥le suppl√©mentaire avant l'intervention de spaCy.

‚ú® Utilisation des R√®gles de Remplacement Personnalis√©es (pour .TXT initialement)
En compl√©ment de l'anonymisation bas√©e sur spaCy (configur√©e via YAML), vous pouvez fournir vos propres r√®gles de recherche/remplacement directes via la ligne de commande. Ces r√®gles sont appliqu√©es avant l'analyse spaCy, ce qui est utile pour masquer des termes sp√©cifiques m√©tier, des codes internes, ou pour forcer un certain remplacement avant que spaCy n'intervienne.

Les r√®gles sont pass√©es via l'option --custom-replacements-json avec une cha√Æne au format JSON. Chaque r√®gle est un objet avec une cl√© "pattern" (le texte ou l'expression r√©guli√®re simple √† rechercher, actuellement insensible √† la casse) et une cl√© "replacement" (le texte de remplacement).

Exemple :
Pour remplacer "CodeAlpha" par "[PROJET_X]" et "R√©union Marketing" par "[√âV√âNEMENT_INTERNE]" dans mon_fichier.txt :

Bash

python main.py anonymize mon_fichier.txt \
  --config ma_config.yaml \
  --custom-replacements-json '[{"pattern": "CodeAlpha", "replacement": "[PROJET_X]"}, {"pattern": "R√©union Marketing", "replacement": "[√âV√âNEMENT_INTERNE]"}]'
Note importante :

Actuellement, cette fonctionnalit√© de remplacement personnalis√© via CLI est pleinement test√©e et op√©rationnelle pour les fichiers .txt.
Les "patterns" sont trait√©s par re.sub avec re.IGNORECASE. Faites attention √† l'√©chappement des caract√®res sp√©ciaux si vous utilisez des regex complexes dans le JSON pass√© en ligne de commande (surtout avec les guillemets et les barres obliques inverses, selon votre terminal).
Ces remplacements personnalis√©s ne sont pas trac√©s dans le fichier de mapping CSV global (qui concerne les entit√©s anonymis√©es par les strat√©gies spaCy).
üîÑ D√©sanonymisation (des entit√©s spaCy)
Bash

python main.py deanonymize chemin/vers/fichier_anonymise.txt \
  --mapping-csv chemin/vers/mapping.csv \
  -o chemin/vers/fichier_restaure.txt
Param√®tres :
chemin/vers/fichier_anonymise.txt : fichier anonymis√©
--mapping-csv : mapping CSV g√©n√©r√© lors de l'anonymisation par spaCy
-o : fichier restaur√©
üß© Exemple de configuration YAML (pour les strat√©gies d'entit√©s spaCy)
Le fichier de configuration YAML (--config) vous permet de d√©finir comment les entit√©s automatiquement d√©tect√©es par spaCy (Personnes, Lieux, Organisations, etc.) doivent √™tre anonymis√©es. Vous pouvez y sp√©cifier des strat√©gies de remplacement (donn√©es factices, codes, caviardage) et des options pour chaque type d'entit√©.

YAML

# Contenu de config.yaml (exemple)
spacy_model: fr_core_news_md # Mod√®le spaCy √† utiliser

replacements: # Strat√©gies de remplacement pour les entit√©s d√©tect√©es par spaCy
  PER:
    type: fake # Remplacer les personnes par des noms factices de la locale sp√©cifi√©e
    options:
      locale: fr_FR
  ORG:
    type: code # Remplacer les organisations par un code s√©quentiel
    options:
      prefix: ENTREPRISE_
      padding: 3 # Ex: ENTREPRISE_001
  EMAIL:
    type: redact # Caviarder les emails avec un texte sp√©cifique
    options:
      text: "[EMAIL_CONFIDENTIEL]"
  DATE:
    type: placeholder # Remplacer par un placeholder format√©
    options:
      format: "[DATE:{}]" # {} sera remplac√© par le label de l'entit√© (DATE)

# Exclure certains labels d'entit√©s spaCy de l'anonymisation
# (Prioritaire sur les d√©finitions dans 'replacements')
exclude_entities:
  # - ORG # Exemple: ne pas anonymiser les organisations, m√™me si une r√®gle existe dans 'replacements'
  # - LOC
spacy_model : sp√©cifie le mod√®le spaCy √† charger (ex: fr_core_news_sm, fr_core_news_md).
replacements : d√©finit la strat√©gie de remplacement (ex: fake, code, redact, placeholder) et les options associ√©es pour chaque type d'entit√© standard (PER, LOC, ORG, DATE, EMAIL, etc.) d√©tect√©e par spaCy.
exclude_entities (dans le YAML) : liste des labels d'entit√©s spaCy (ex: PER, ORG) qui ne doivent pas √™tre anonymis√©es, m√™me si d√©tect√©es et m√™me si une r√®gle de remplacement est d√©finie pour elles. Ceci est diff√©rent de l'option CLI --exclude-entities qui a un effet similaire et est g√©n√©ralement prioritaire si les deux sont utilis√©s.
Plus d‚Äôexemples dans le dossier examples/.

üîç Table des entit√©s support√©es (par spaCy et strat√©gies de base dans le YAML)
Type	Label	Exemple	Strat√©gie(s) YAML possibles
Personnes	PER	Jean Dupont	fake, code, redact, placeholder
Lieux	LOC	Paris, Orl√©ans	fake, code, redact, placeholder
Organisations	ORG	ACME Corp.	fake, code, redact, placeholder
Email	EMAIL	contact@acme.fr	fake, code, redact, placeholder
Dates	DATE	2024-04-18	fake, code, redact, placeholder
T√©l√©phone	PHONE	0612345678	fake, code, redact, placeholder
IBAN	IBAN	FR76...	fake, code, redact, placeholder
Adresse	ADDRESS	12 rue X, 75000 Y	fake, code, redact, placeholder
...	...	...	...

Exporter vers Sheets
Note : La d√©tection native de PHONE, IBAN, ADDRESS peut n√©cessiter des mod√®les spaCy plus larges (comme fr_core_news_lg) ou des r√®gles de d√©tection personnalis√©es (non couvertes par l'exemple de configuration YAML simple ci-dessus, mais possibles via une section custom_rules plus avanc√©e dans le YAML si votre schema.yaml le permet pour d√©finir de nouvelles √©tiquettes).

üìÇ Structure d√©taill√©e du projet
Plaintext

anonyfiles_cli/
‚îÇ
‚îú‚îÄ‚îÄ main.py                # Point d‚Äôentr√©e principal pour la CLI
‚îú‚îÄ‚îÄ requirements.txt       # D√©pendances Python
‚îú‚îÄ‚îÄ README.md              # Ce fichier
‚îÇ
‚îú‚îÄ‚îÄ anonymizer/            # Moteur principal d‚Äôanonymisation
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ anonyfiles_core.py # Logique d‚Äôanonymisation (orchestration)
‚îÇ   ‚îú‚îÄ‚îÄ spacy_engine.py    # Interactions avec spaCy pour la d√©tection
‚îÇ   ‚îú‚îÄ‚îÄ replacer.py        # Logique de g√©n√©ration des remplacements (pour spaCy)
‚îÇ   ‚îú‚îÄ‚îÄ base_processor.py  # Classe de base pour les processeurs de fichiers
‚îÇ   ‚îú‚îÄ‚îÄ txt_processor.py   # Processeur pour les fichiers .txt
‚îÇ   ‚îú‚îÄ‚îÄ csv_processor.py   # Processeur pour les fichiers .csv
‚îÇ   ‚îú‚îÄ‚îÄ docx_processor.py  # Processeur pour les fichiers .docx
‚îÇ   ‚îú‚îÄ‚îÄ excel_processor.py # Processeur pour les fichiers .xlsx
‚îÇ   ‚îú‚îÄ‚îÄ pdf_processor.py   # Processeur pour les fichiers .pdf
‚îÇ   ‚îú‚îÄ‚îÄ json_processor.py  # Processeur pour les fichiers .json
‚îÇ   ‚îú‚îÄ‚îÄ utils.py           # Fonctions utilitaires (ex: apply_positional_replacements)
‚îÇ   ‚îî‚îÄ‚îÄ deanonymize.py     # Logique de d√©sanonymisation
‚îÇ
‚îú‚îÄ‚îÄ config/                # Exemples de configurations et sch√©mas
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml        # Exemple de fichier de configuration principal
‚îÇ   ‚îú‚îÄ‚îÄ generated_config.yaml # Peut-√™tre une config g√©n√©r√©e par l'UI
‚îÇ   ‚îî‚îÄ‚îÄ schema.yaml        # Sch√©ma de validation pour config.yaml
‚îÇ
‚îú‚îÄ‚îÄ examples/              # Exemples de fichiers d'entr√©e
‚îÇ   ‚îú‚îÄ‚îÄ exemple.txt
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ output_files/          # (Par d√©faut, g√©n√©r√©) Fichiers anonymis√©s
‚îú‚îÄ‚îÄ log/                   # (Par d√©faut, g√©n√©r√©) Logs d‚Äôentit√©s
‚îú‚îÄ‚îÄ mappings/              # (Par d√©faut, g√©n√©r√©) Mappings pour d√©sanonymisation
‚îú‚îÄ‚îÄ tests/                 # Jeux de tests unitaires/qualit√©
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ ...
(Structure de projet indicative, adaptez selon votre organisation r√©elle).

üìù Bonnes pratiques & conseils
S√©curisez vos mappings ! Les fichiers de mapping CSV permettent la d√©sanonymisation totale des entit√©s spaCy.
Testez sur des jeux de donn√©es non sensibles avant la mise en production.
Documentez vos configurations YAML et conservez-les pour l‚Äôaudit.
V√©rifiez r√©guli√®rement les logs d‚Äôentit√©s spaCy pour contr√¥ler les faux positifs/n√©gatifs.
Tenez √† jour spaCy et Faker pour profiter des derni√®res am√©liorations.
Pour les r√®gles personnalis√©es via CLI, soyez pr√©cis avec vos patterns, surtout si vous utilisez des expressions r√©guli√®res, pour √©viter des remplacements non d√©sir√©s.
üìú Licence
Distribu√© sous licence MIT.

üí¨ Ressources & liens utiles
Documentation compl√®te (Lien vers votre repo principal)
Anonyfiles GUI (interface graphique)
spaCy Documentation
Faker Documentation